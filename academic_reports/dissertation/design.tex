\section{Design}
\label{s:design}
\hspace{10pt} This section describes the design of the software components and the experiments involved in the dissertation. The first subsection outlines how energy demands of different sensors are compared. This includes the design principles behind sample sensor applications and the details on how to measure their energy efficiency. The second subsection layouts the energy efficient sensing library, Sensy. [XXX keep going here on Sensy]. The design presented in this section will be revisited in the next section.

\subsection{Sensors energy measurements}
\label{s:design:measurements}
\hspace{10pt} Sensors energy measurements is a part of the project, where the energy efficiencies of different sensors are determined. To achieve this objective, each sensor is represented in the series of simple Android applications, \textbf{Sample Sensor Applications}. Each of those applications keeps continuously sampling one sensor and switches off all others. Sample Sensor Applications are designed in the way that only one difference between them should be which sensor is being currently sampled. To compare sensors' energy demands, the novel method of measuring energy efficiency of the applications is proposed. The method calculates time which each application needs to deplete one percentage of battery life. The order of energy efficiency of different sensors may be established by comparing those time measurements: the most energy efficient sensor will be the one which one percentage battery depletion takes the longest. 

\subsubsection{Sample sensor applications}
\label{s:design:measurements:sampleapps}
\hspace{10pt} To determine differences in sensors' energy efficiency, each of sample applications keeps sampling only one sensor while all others sensors are being switched off.  However, \textbf{this triggers other differences between applications}: various sampling frequencies and size of sensor data. Sine I aim to compare the energy efficiency of sampling itself, those other differences' impact is trying to be minimized. 

\textbf{Sampling frequencies vary among sensors}. Inertial sensors e.g., accelerometer or gyroscope could be sampled as often as every 20 milliseconds, whereas the minimum frequency of GPS equals to 20 seconds. The issue is more complex in case of wireless communication sensors such as Bluetooth or IEEE 802.11. A full Bluetooth scan takes around 12 secs, but it could be stopped earlier and started again. To alleviate those differences, \textbf{the least energy-efficient strategy of complete, correct sampling} is chosen for the comparison of sensors' energy efficiency.[XXX reason] Sensors are being sampled as often as possible providing that the previous sample delivered valid data. For example, the next IEEE 802.11 scan will be started once the previous one has been finished\ (IEEE 802.11 scan takes around 2.5 secs depending on the device). This provides complete information on available access points while minimizing sampling frequency, which increases its energy consumption. The strategy will look similar for GPS and Bluetooth. In case of other sensors (inertial sensors, camera and microphone), the strategy will be executed by sensors being sampled as often as possible (sampling is immediate). 

[XXX ^^ REASON WHY I CHOSE this strategy of comparison]

To check whether Sample Sensor Applications work correctly, each application prints out its raw sensor data. The frequency of this output equals to 1 second and is the same for all applications. As described in the previous paragraph, sensors data are delivered on different frequencies. If the raw data would be also printed on different frequencies, this could add noise to our experiments. By using \textbf{the same frequency of printing out raw data for all applications}, the differences in sampling frequencies are mitigated. GPS sample application will print out its raw sensor data as often as accelerometer sample application, though those applications have different sensor sampling frequencies. It is worth noticing that as a side effect, printed values may be repetitive or missing, when no new sensor data were delivered. 

Another issue concerning application's output is \textbf{different sizes of raw data among sensors}. For example, the result of wireless communication scans\ (IEEE 802.11 and Bluetooth) is the list of records (e.g., 20 hot spots with their names and other parameters), whereas light sensor's result  is just a single number. Furthermore, more complex data is delivered by camera or microphone. As the raw data is printed on regular basis, those differences could lead to significant changes in energy efficiency of Sample Sensor Applications. To alleviate those differences, \textbf{the output is standardized} and has the same form for all applications. The one line of the output, which includes between 1 and 3 numbers, is printed.

Those number may represent different information depending on a sensor:
\begin{itemize}
	\item For wireless communications sensors, only the amount of available hotspot/devices is printed: 
		\plot{output_wifiscan}
	\item For microphone, the maximum absolute amplitude for every second is printed:
		\plot{output_microphone}
	\item For camera, the total size of recorder video is printed:
		\plot{output_camera}
	\item Light and proximity sensor provide only one value:
		\plot{output_light}
	\item Other inertial sensor provide all three coordinates:
		\plot{output_inertial}
\end{itemize}

There are still other issues, which could add noise to the experiments e.g., various API among sensors or different capabilities of IEEE 802.11 wireless cards. However, all differences noticeable on the application level are eliminated. Such design of Sample Sensor Applications guarantees that on the energy efficiencies of different sensors' sampling will be compared. 
				
\subsubsection{1\% battery depletion}	
\label{s:design:measurements:method}
\hspace{10pt} Once  Sample Sensor Applications are prepared, the order of their energy efficiency needs to be established. To compare their energy efficiency, I make time measurements on how long 1\% depletion of battery life takes. Then, those time measurements are compared. For any two sensors, if there is longer time needed for 1\% depletion of one of them, it means that this sensor is more energy-efficient. It is worth mentioning that 1\% is used, since that is a precision of the information on battery life's status which Android API provides.

\textbf{The method should be accurate if the comparison is made on the same percentage of battery life} e.g., between 99\% and 98\%. Although the battery life is nonlinear, the battery should behave similarly on the same percentage across many runs. The measurements should be similar and repetitive. Also, time measurements should not take long, which creates a chance for accurate online energy measurements. All of those assumptions will be validated in the next section.

For the purpose of this dissertation, this measurement method was directly incorporated into Sample Sensor Applications. Each sample sensor application is continuously querying the battery status and the time of 1\% battery depletion is registered. The whole process is exactly the same for all sample sensor applications. Because of that, no noise to the experiments is added.

\subsubsection{The list of sample sensor applications}	
\label{s:design:measurements:applications}
The below table consists of the complete list of Sample Sensor Applications created for this project. Beside the Sample Sensor Applications, a couple of supporting applications were implemented:
\begin{itemize}
	\item EnergyMeasurementListSensors - listing all physical sensors available in a mobile phone.,
	\item EnergyMeasurementNetwork - determining energy efficiency of Android wireless-based localization.
	\item EnergyMeasurementGPSSatellites - determining energy efficiency of Android wireless-based localization.	
\end{itemize}
All of those applications could be found in \textit{sensors\_energy\_measurement/sample\_apps} directory.
		
\begin{table}[H]
	\centering
    \begin{tabular}{| l | r | }
    \hline
    Sensor & Application name \\ \hline
    Camera & EnergyMeasurementCamera \\ \hline
    Microphone & EnergyMeasurementMicrophone \\\hline
    IEEE 802.11 & EnergyMeasurementWifi80211 \\ \hline
    GPS & EnergyMeasurementGPS \\ \hline
    Bluetooth & EnergyMeasurementBluetooth \\ \hline
    Bluetooth LTE & EnergyMeasurementBluetoothLE \\ \hline
    Accelerometer & EnergyMeasurementAcceleromter \\ \hline
    Gyroscope & EnergyMeasurementGyroscope \\ \hline
    Magnetic Field & EnergyMeasurementMagneticField\\ \hline
    Ambient Light & EnergyMeasurementLight \\ \hline
    Proximity & EnergyMeasurementProximity \\ \hline
    \end{tabular}
    \caption{The complete list of Sample Sensor Applications.}
	\label{table:samplesensorapps}
\end{table}			


\subsection{Sensy}
\label{s:design:sensy}

sensor substitution

\subsubsection{Moving detection}
-standard deviation
	-threshold
-sliding window

-address whether it is user dependent algorithm

\subsubsection{Adaptive duty-cycling sampling}
duty-cycling
\label{s:design:sensy:adaptive}
